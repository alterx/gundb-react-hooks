{"version":3,"file":"gundb-react-hooks.modern.js","sources":["../../src/index.ts"],"sourcesContent":["import { useState, useEffect, useReducer, useRef } from 'react';\n\nexport type GunStatic = any;\n\nexport type GunRef = any;\n\nexport type NamespacedRef = any;\n\nexport type KeyPair = {\n  pub: string;\n  priv: string;\n  epub: string;\n  epriv: string;\n};\n\nexport type Options = {\n  appKeys?: undefined | string | KeyPair;\n  sea?: any;\n  interval?: number;\n  useOpen?: boolean;\n};\n\nexport type ActionType = {\n  type: string;\n  data: any;\n};\n\nexport type UpdateType = {\n  id: string;\n  data: any;\n};\n\nexport interface GunOptions\n  extends Partial<{\n    file: string;\n    web: any;\n    s3: {\n      key: any;\n      secret: any;\n      bucket: any;\n    };\n    peers: string[] | Record<string, {}>;\n    radisk: boolean;\n    localStorage: boolean;\n    uuid(): string;\n    [key: string]: any;\n  }> {}\n\nexport const encryptData = async (\n  data: any,\n  keys: undefined | string | KeyPair,\n  sea: any\n) => {\n  return keys && sea ? sea.encrypt(data, keys) : Promise.resolve(data);\n};\n\nexport const decryptData = async (\n  data: any,\n  keys: undefined | string | KeyPair,\n  sea: any\n) => {\n  return keys && sea ? sea.decrypt(data, keys) : Promise.resolve(data);\n};\n\nexport const debouncedUpdates = (dispatcher, timeout = 100) => {\n  let updates: any[] = [];\n  let handler;\n  return (update: UpdateType) => {\n    updates.push(update);\n    if (!handler) {\n      handler = setTimeout(() => {\n        let newStateSlice = updates.reduce((previousState, { id, data }) => {\n          previousState[id] = data;\n          return previousState;\n        }, {});\n        dispatcher(newStateSlice);\n        updates = [];\n        handler = null;\n      }, timeout);\n    }\n\n    return () => {\n      clearTimeout(handler);\n      updates = [];\n      handler = null;\n    };\n  };\n};\n\nexport const reducer = (state: {}, { data, type }: ActionType) => {\n  switch (type) {\n    case 'add':\n      return { ...state, ...data };\n    case 'update':\n      return { ...state, [data.nodeID]: data };\n    case 'remove':\n      delete state[data];\n      return { ...state };\n    default:\n      throw new Error();\n  }\n};\n\nexport const useIsMounted = () => {\n  const isMounted = useRef(false);\n  useEffect(() => {\n    isMounted.current = true;\n    return () => (isMounted.current = false);\n  }, []);\n  return isMounted;\n};\n\nexport const useSafeReducer = <T>(reducer, initialState): [T, Function] => {\n  const [state, dispatch] = useReducer<T>(reducer, initialState);\n  const isMounted = useIsMounted();\n\n  function safeDispatch(args) {\n    if (isMounted.current) {\n      dispatch(args);\n    }\n  }\n\n  return [state, safeDispatch];\n};\n\nexport const useGun = (Gun: GunStatic, opts: GunOptions) => {\n  const [gun] = useState(Gun(opts));\n\n  return [gun];\n};\n\nexport const useGunNamespace = (gun: GunRef) => {\n  const [namespace, setNamespace] = useState(null);\n  if (!namespace) {\n    setNamespace(gun.user());\n  }\n  return [namespace];\n};\n\nexport const useGunKeyAuth = (\n  gun: GunRef,\n  keys: KeyPair,\n  triggerAuth: boolean = true\n) => {\n  // Will attempt to perform a login (when triggerAuth is set to true),\n  // or, if false, returns a namespaced gun node\n  const [namespacedGraph] = useGunNamespace(gun);\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n\n  gun.on('auth', () => {\n    setIsLoggedIn(true);\n  });\n\n  useEffect(() => {\n    if (namespacedGraph && !namespacedGraph.is && keys && triggerAuth) {\n      namespacedGraph.auth(keys);\n    }\n  }, [triggerAuth, namespacedGraph, keys]);\n\n  return [namespacedGraph, isLoggedIn];\n};\n\nexport const useGunKeys = (sea: any, initialValue: any) => {\n  const [keys, setKeys] = useState(initialValue);\n\n  async function getKeySet() {\n    const pair: KeyPair = await sea.pair();\n    setKeys(pair);\n  }\n\n  if (!keys) {\n    getKeySet();\n  }\n\n  return [keys, setKeys];\n};\n\nexport const useGunState = <T>(\n  ref: GunRef,\n  opts: Options = {\n    appKeys: '',\n    sea: null,\n    interval: 100,\n    useOpen: false,\n  }\n) => {\n  const { appKeys, sea, interval = 100, useOpen = false } = opts;\n  const [gunAppGraph] = useState(ref);\n  const [fields, dispatch] = useSafeReducer<T>(reducer, {});\n  const handler = useRef(null);\n  const isMounted = useIsMounted();\n\n  useEffect(() => {\n    const debouncedHandlers: Function[] = [];\n    if (isMounted.current) {\n      const updater = debouncedUpdates((data) => {\n        dispatch({ type: 'add', data });\n      }, interval);\n\n      const gunCb = async (encryptedField, nodeID, message, event) => {\n        let decryptedField = await decryptData(encryptedField, appKeys, sea);\n        Object.keys(decryptedField).forEach((key) => {\n          let cleanFn = updater({ id: key, data: decryptedField[key] });\n          debouncedHandlers.push(cleanFn);\n        });\n\n        if (!handler.current) {\n          handler.current = event;\n        }\n      };\n\n      if (useOpen) {\n        if (!gunAppGraph.open) {\n          throw new Error('Please include gun/lib/open.');\n        } else {\n          gunAppGraph.open(gunCb);\n        }\n      } else {\n        gunAppGraph.on(gunCb);\n      }\n    }\n\n    return () => {\n      if (handler.current) {\n        //cleanup gun .on listener\n        handler.current.off();\n      }\n      if (debouncedHandlers.length) {\n        //cleanup timeouts\n        debouncedHandlers.forEach((c) => c());\n      }\n    };\n    // We just need to set the listener once\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Working with root node fields\n  const put = async (data: T) => {\n    let encryptedData = await encryptData(data, appKeys, sea);\n    await new Promise((resolve, reject) =>\n      gunAppGraph.put(encryptedData, (ack) =>\n        ack.err ? reject(ack.err) : resolve()\n      )\n    );\n  };\n\n  const remove = async (field: string) => {\n    await new Promise((resolve, reject) =>\n      gunAppGraph.put(null, (ack) => (ack.err ? reject(ack.err) : resolve()))\n    );\n    dispatch({ type: 'remove', data: field });\n  };\n\n  return { fields, put, remove };\n};\n\nexport const useGunCollectionState = <T>(\n  ref: GunRef,\n  opts: Options = {\n    appKeys: '',\n    sea: null,\n    interval: 100,\n    useOpen: false,\n  }\n) => {\n  const { appKeys, sea, interval = 100, useOpen } = opts;\n  const [gunAppGraph] = useState(ref);\n  const [collection, dispatch] = useSafeReducer<Record<string, T>>(reducer, {});\n  const handler = useRef(null);\n  const isMounted = useIsMounted();\n\n  // Working with Sets\n  useEffect(() => {\n    const debouncedHandlers: Function[] = [];\n    if (isMounted.current) {\n      const updater = debouncedUpdates((data) => {\n        dispatch({ type: 'add', data });\n      }, interval);\n\n      const gunCb = async (encryptedNode, nodeID, message, event) => {\n        let item = await decryptData(encryptedNode, appKeys, sea);\n        if (item) {\n          let cleanFn = updater({\n            id: nodeID,\n            data: { ...item, nodeID },\n          });\n          debouncedHandlers.push(cleanFn);\n        }\n\n        if (!handler.current) {\n          handler.current = event;\n        }\n      };\n\n      if (useOpen) {\n        if (!gunAppGraph.open) {\n          throw new Error('Please include gun/lib/open.');\n        } else {\n          gunAppGraph.map().open(gunCb);\n        }\n      } else {\n        gunAppGraph.map().on(gunCb);\n      }\n    }\n\n    return () => {\n      if (handler.current) {\n        //cleanup gun .on listener\n        handler.current.off();\n      }\n      if (debouncedHandlers.length) {\n        //cleanup timeouts\n        debouncedHandlers.forEach((c) => c());\n      }\n    };\n    // We just need to set the listener once\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const updateInSet = async (nodeID: string, data: T) => {\n    let encryptedData = await encryptData(data, appKeys, sea);\n    await new Promise((resolve, reject) =>\n      gunAppGraph\n        .get(nodeID)\n        .put(encryptedData, (ack) => (ack.err ? reject(ack.err) : resolve()))\n    );\n    dispatch({ type: 'update', data: { nodeID, ...data } });\n  };\n\n  const addToSet = async (data: T, nodeID?: string) => {\n    let encryptedData = await encryptData(data, appKeys, sea);\n    if (!nodeID) {\n      await new Promise((resolve, reject) =>\n        gunAppGraph.set(encryptedData, (ack) =>\n          ack.err ? reject(ack.err) : resolve()\n        )\n      );\n    } else {\n      await new Promise((resolve, reject) =>\n        gunAppGraph\n          .get(nodeID)\n          .put(encryptedData, (ack) => (ack.err ? reject(ack.err) : resolve()))\n      );\n    }\n  };\n\n  const removeFromSet = async (nodeID: string) => {\n    await new Promise((resolve, reject) =>\n      gunAppGraph\n        .get(nodeID)\n        .put(null, (ack) => (ack.err ? reject(ack.err) : resolve()))\n    );\n  };\n\n  return { collection, addToSet, updateInSet, removeFromSet };\n};\n"],"names":["encryptData","data","keys","sea","encrypt","Promise","resolve","decryptData","decrypt","debouncedUpdates","dispatcher","timeout","updates","handler","update","push","setTimeout","newStateSlice","reduce","previousState","id","clearTimeout","reducer","state","type","nodeID","Error","useIsMounted","isMounted","useRef","useEffect","current","useSafeReducer","initialState","dispatch","useReducer","safeDispatch","args","useGun","Gun","opts","gun","useState","useGunNamespace","namespace","setNamespace","user","useGunKeyAuth","triggerAuth","namespacedGraph","isLoggedIn","setIsLoggedIn","on","is","auth","useGunKeys","initialValue","setKeys","getKeySet","pair","useGunState","ref","appKeys","interval","useOpen","gunAppGraph","fields","debouncedHandlers","updater","gunCb","encryptedField","message","event","decryptedField","Object","forEach","key","cleanFn","open","off","length","c","put","encryptedData","reject","ack","err","remove","field","useGunCollectionState","collection","encryptedNode","item","map","updateInSet","get","addToSet","set","removeFromSet"],"mappings":"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"}