import{useRef as r,useEffect as e,useReducer as n,useState as t}from"react";function u(){return(u=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[t]=n[t])}return r}).apply(this,arguments)}var o=function(r,e,n){try{return Promise.resolve(e&&n?n.encrypt(r,e):r)}catch(r){return Promise.reject(r)}},i=function(r,e,n){try{return Promise.resolve(e&&n?n.decrypt(r,e):r)}catch(r){return Promise.reject(r)}},c=function(r,e){void 0===e&&(e=100);var n,t=[];return function(u){return t.push(u),n||(n=setTimeout(function(){var e=t.reduce(function(r,e){return r[e.id]=e.data,r},{});r(e),t=[],n=null},e)),function(){clearTimeout(n),t=[],n=null}}},a=function(r,e){var n,t=e.data;switch(e.type){case"add":return u({},r,t);case"update":return u({},r,((n={})[t.nodeID]=t,n));case"remove":return delete r[t],u({},r);default:throw new Error}},f=function(){var n=r(!1);return e(function(){return n.current=!0,function(){return n.current=!1}},[]),n},s=function(r,e){var t=n(r,e),u=t[0],o=t[1],i=f();return[u,function(r){i.current&&o(r)}]},l=function(r,e){return[t(r({peers:e}))[0]]},v=function(r){var e=t(null),n=e[0];return n||(0,e[1])(r.user()),[n]},p=function(r,n,u){void 0===u&&(u=!0);var o=v(r)[0],i=t(!1),c=i[0],a=i[1];return r.on("auth",function(){a(!0)}),e(function(){o&&!o.is&&n&&u&&o.auth(n)},[u,o,n]),[o,c]},h=function(r,e){var n=t(e),u=n[0],o=n[1];return u||function(){try{Promise.resolve(r.pair()).then(function(r){o(r)})}catch(r){return Promise.reject(r)}}(),[u,o]},m=function(n,u){void 0===u&&(u={appKeys:"",sea:null,interval:100,useOpen:!1});var l=u.appKeys,v=u.sea,p=u.interval,h=void 0===p?100:p,m=u.useOpen,d=void 0!==m&&m,P=t(n)[0],y=s(a,{}),w=y[0],j=y[1],g=r(null),O=f();return e(function(){var r=[];if(O.current){var e=c(function(r){j({type:"add",data:r})},h),n=function(n,t,u,o){try{return Promise.resolve(i(n,l,v)).then(function(n){Object.keys(n).forEach(function(t){var u=e({id:t,data:n[t]});r.push(u)}),g.current||(g.current=o)})}catch(r){return Promise.reject(r)}};if(d){if(!P.open)throw new Error("Please include gun/lib/open.");P.open(n)}else P.on(n)}return function(){g.current&&g.current.off(),r.length&&r.forEach(function(r){return r()})}},[]),{fields:w,put:function(r){try{return Promise.resolve(o(r,l,v)).then(function(r){return Promise.resolve(new Promise(function(e,n){return P.put(r,function(r){return r.err?n(r.err):e()})})).then(function(){})})}catch(r){return Promise.reject(r)}},remove:function(r){try{return Promise.resolve(new Promise(function(r,e){return P.put(null,function(n){return n.err?e(n.err):r()})})).then(function(){j({type:"remove",data:r})})}catch(r){return Promise.reject(r)}}}},d=function(n,l){void 0===l&&(l={appKeys:"",sea:null,interval:100,useOpen:!1});var v=l.appKeys,p=l.sea,h=l.interval,m=void 0===h?100:h,d=l.useOpen,P=t(n)[0],y=s(a,{}),w=y[0],j=y[1],g=r(null),O=f();return e(function(){var r=[];if(O.current){var e=c(function(r){j({type:"add",data:r})},m),n=function(n,t,o,c){try{return Promise.resolve(i(n,v,p)).then(function(n){if(n){var o=e({id:t,data:u({},n,{nodeID:t})});r.push(o)}g.current||(g.current=c)})}catch(r){return Promise.reject(r)}};if(d){if(!P.open)throw new Error("Please include gun/lib/open.");P.map().open(n)}else P.map().on(n)}return function(){g.current&&g.current.off(),r.length&&r.forEach(function(r){return r()})}},[]),{collection:w,addToSet:function(r,e){try{return Promise.resolve(o(r,v,p)).then(function(r){var n=e?Promise.resolve(new Promise(function(n,t){return P.get(e).put(r,function(r){return r.err?t(r.err):n()})})).then(function(){}):Promise.resolve(new Promise(function(e,n){return P.set(r,function(r){return r.err?n(r.err):e()})})).then(function(){});if(n&&n.then)return n.then(function(){})})}catch(r){return Promise.reject(r)}},updateInSet:function(r,e){try{return Promise.resolve(o(e,v,p)).then(function(n){return Promise.resolve(new Promise(function(e,t){return P.get(r).put(n,function(r){return r.err?t(r.err):e()})})).then(function(){j({type:"update",data:u({nodeID:r},e)})})})}catch(r){return Promise.reject(r)}},removeFromSet:function(r){try{return Promise.resolve(new Promise(function(e,n){return P.get(r).put(null,function(r){return r.err?n(r.err):e()})})).then(function(){})}catch(r){return Promise.reject(r)}}}};export{c as debouncedUpdates,i as decryptData,o as encryptData,a as reducer,l as useGun,d as useGunCollectionState,p as useGunKeyAuth,h as useGunKeys,v as useGunNamespace,m as useGunState,f as useIsMounted,s as useSafeReducer};
//# sourceMappingURL=index.module.js.map
