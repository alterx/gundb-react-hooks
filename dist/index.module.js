import{useState as r,useEffect as e,useReducer as n,useRef as t}from"react";var u=function(r,e,n){try{return Promise.resolve(e&&n?n.encrypt(r,e):r)}catch(r){return Promise.reject(r)}},o=function(r,e,n){try{return Promise.resolve(e&&n?n.decrypt(r,e):r)}catch(r){return Promise.reject(r)}},i=function(r,e){void 0===e&&(e=100);var n,t=[];return function(u){return t.push(u),n||(n=setTimeout(function(){var e=t.reduce(function(r,e){return r[e.id]=e.data,r},{});r(e),t=[],n=null},e)),function(){clearTimeout(n),t=[],n=null}}},c=function(r,e){var n,t=e.data;switch(e.type){case"add":return Object.assign({},r,t);case"update":return Object.assign({},r,((n={})[t.nodeID]=t,n));case"remove":return delete r[t],Object.assign({},r);default:throw new Error}},a=function(){var r=t(!1);return e(function(){return r.current=!0,function(){return r.current=!1}},[]),r},s=function(r,e){var t=n(r,e),u=t[0],o=t[1],i=a();return[u,function(r){i.current&&o(r)}]},f=function(e,n){return[r(e({peers:n}))[0]]},l=function(e){var n=r(null),t=n[0];return t||(0,n[1])(e.user()),[t]},v=function(n,t,u){void 0===u&&(u=!0);var o=l(n)[0],i=r(!1),c=i[0],a=i[1];return n.on("auth",function(){a(!0)}),e(function(){o&&!o.is&&t&&u&&o.auth(t)},[u,o,t]),[o,c]},p=function(e,n){var t=r(n),u=t[0],o=t[1];return u||function(){try{Promise.resolve(e.pair()).then(function(r){o(r)})}catch(r){return Promise.reject(r)}}(),[u,o]},m=function(n,f){void 0===f&&(f={appKeys:"",sea:null,interval:100,useOpen:!1});var l=f.appKeys,v=f.sea,p=f.interval;void 0===p&&(p=100);var m=f.useOpen;void 0===m&&(m=!1);var d=r(n)[0],h=s(c,{}),P=h[0],y=h[1],j=t(null),w=a();return e(function(){var r=[];if(w.current){var e=i(function(r){y({type:"add",data:r})},p),n=function(n,t,u,i){try{return Promise.resolve(o(n,l,v)).then(function(n){Object.keys(n).forEach(function(t){var u=e({id:t,data:n[t]});r.push(u)}),j.current||(j.current=i)})}catch(r){return Promise.reject(r)}};if(m){if(!d.open)throw new Error("Please include gun/lib/open.");d.open(n)}else d.on(n)}return function(){j.current&&j.current.off(),r.length&&r.forEach(function(r){return r()})}},[]),{fields:P,put:function(r){try{return Promise.resolve(u(r,l,v)).then(function(r){return Promise.resolve(new Promise(function(e,n){return d.put(r,function(r){return r.err?n(r.err):e()})})).then(function(){})})}catch(r){return Promise.reject(r)}},remove:function(r){try{return Promise.resolve(new Promise(function(r,e){return d.put(null,function(n){return n.err?e(n.err):r()})})).then(function(){y({type:"remove",data:r})})}catch(r){return Promise.reject(r)}}}},d=function(n,f){void 0===f&&(f={appKeys:"",sea:null,interval:100,useOpen:!1});var l=f.appKeys,v=f.sea,p=f.interval;void 0===p&&(p=100);var m=f.useOpen,d=r(n)[0],h=s(c,{}),P=h[0],y=h[1],j=t(null),w=a();return e(function(){var r=[];if(w.current){var e=i(function(r){y({type:"add",data:r})},p),n=function(n,t,u,i){try{return Promise.resolve(o(n,l,v)).then(function(n){if(n){var u=e({id:t,data:Object.assign({},n,{nodeID:t})});r.push(u)}j.current||(j.current=i)})}catch(r){return Promise.reject(r)}};if(m){if(!d.open)throw new Error("Please include gun/lib/open.");d.map().open(n)}else d.map().on(n)}return function(){j.current&&j.current.off(),r.length&&r.forEach(function(r){return r()})}},[]),{collection:P,addToSet:function(r,e){try{return Promise.resolve(u(r,l,v)).then(function(r){var n=e?Promise.resolve(new Promise(function(n,t){return d.get(e).put(r,function(r){return r.err?t(r.err):n()})})).then(function(){}):Promise.resolve(new Promise(function(e,n){return d.set(r,function(r){return r.err?n(r.err):e()})})).then(function(){});if(n&&n.then)return n.then(function(){})})}catch(r){return Promise.reject(r)}},updateInSet:function(r,e){try{return Promise.resolve(u(e,l,v)).then(function(n){return Promise.resolve(new Promise(function(e,t){return d.get(r).put(n,function(r){return r.err?t(r.err):e()})})).then(function(){y({type:"update",data:Object.assign({},{nodeID:r},e)})})})}catch(r){return Promise.reject(r)}},removeFromSet:function(r){try{return Promise.resolve(new Promise(function(e,n){return d.get(r).put(null,function(r){return r.err?n(r.err):e()})})).then(function(){})}catch(r){return Promise.reject(r)}}}};export{u as encryptData,o as decryptData,i as debouncedUpdates,c as reducer,a as useIsMounted,s as useSafeReducer,f as useGun,l as useGunNamespace,v as useGunKeyAuth,p as useGunKeys,m as useGunState,d as useGunCollectionState};
//# sourceMappingURL=index.module.js.map
