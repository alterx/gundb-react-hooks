import{useState as e,useEffect as r,useReducer as n,useRef as t}from"react";var u=function(e,r,n){try{return Promise.resolve(r&&n?n.encrypt(e,r):e)}catch(e){return Promise.reject(e)}},o=function(e,r,n){try{return Promise.resolve(r&&n?n.decrypt(e,r):e)}catch(e){return Promise.reject(e)}},i=function(e,r){void 0===r&&(r=100);var n,t=[];return function(u){return t.push(u),n||(n=setTimeout(function(){var r=t.reduce(function(e,r){return e[r.id]=r.data,e},{});e(r),t=[],n=null},r)),function(){clearTimeout(n),t=[],n=null}}},c=function(e,r){var n,t=r.data;switch(r.type){case"add":return Object.assign({},e,t);case"update":return Object.assign({},e,((n={})[t.nodeID]=t,n));case"remove":return delete e[t],Object.assign({},e);default:throw new Error}},a=function(){var e=t(!1);return r(function(){return e.current=!0,function(){return e.current=!1}},[]),e},s=function(e,r){var t=n(e,r),u=t[0],o=t[1],i=a();return[u,function(e){i.current&&o(e)}]},f=function(r,n){return[e(r({peers:n}))[0]]},l=function(r){var n=e(null),t=n[0];return t||(0,n[1])(r.user()),[t]},v=function(n,t,u){void 0===u&&(u=!0);var o=l(n)[0],i=e(!1),c=i[0],a=i[1];return n.on("auth",function(){a(!0)}),r(function(){o&&!o.is&&t&&u&&o.auth(t)},[u,o,t]),[o,c]},p=function(r,n){var t=e(n),u=t[0],o=t[1];return u||function(){try{Promise.resolve(r.pair()).then(function(e){o(e)})}catch(e){return Promise.reject(e)}}(),[u,o]},m=function(n,f){void 0===f&&(f={appKeys:"",sea:null,interval:100,useOpen:!1});var l=f.appKeys,v=f.sea,p=f.interval;void 0===p&&(p=100);var m=f.useOpen;void 0===m&&(m=!1);var d=e(n)[0],h=s(c,{}),P=h[0],y=h[1],j=t(null),w=a();return r(function(){var e=[];if(w.current){var r=i(function(e){y({type:"add",data:e})},p),n=function(n,t,u,i){try{return Promise.resolve(o(n,l,v)).then(function(n){Object.keys(n).forEach(function(t){var u=r({id:t,data:n[t]});e.push(u)}),j.current||(j.current=i)})}catch(e){return Promise.reject(e)}};if(m){if(!d.open)throw new Error("Please include gun/lib/open.");d.open(n)}else d.on(n)}return function(){j.current&&j.current.off(),e.length&&e.forEach(function(e){return e()})}},[]),{fields:P,put:function(e){try{return Promise.resolve(u(e,l,v)).then(function(e){return Promise.resolve(new Promise(function(r,n){return d.put(e,function(e){return e.ok?r():n(e.err)})})).then(function(){})})}catch(e){return Promise.reject(e)}},remove:function(e){try{return Promise.resolve(new Promise(function(e,r){return d.put(null,function(n){return n.ok?e():r(n.err)})})).then(function(){y({type:"remove",data:e})})}catch(e){return Promise.reject(e)}}}},d=function(n,f){void 0===f&&(f={appKeys:"",sea:null,interval:100,useOpen:!1});var l=f.appKeys,v=f.sea,p=f.interval;void 0===p&&(p=100);var m=f.useOpen,d=e(n)[0],h=s(c,{}),P=h[0],y=h[1],j=t(null),w=a();return r(function(){var e=[];if(w.current){var r=i(function(e){y({type:"add",data:e})},p),n=function(n,t,u,i){try{return Promise.resolve(o(n,l,v)).then(function(n){if(n){var u=r({id:t,data:Object.assign({},n,{nodeID:t})});e.push(u)}j.current||(j.current=i)})}catch(e){return Promise.reject(e)}};if(m){if(!d.open)throw new Error("Please include gun/lib/open.");d.map().open(n)}else d.map().on(n)}return function(){j.current&&j.current.off(),e.length&&e.forEach(function(e){return e()})}},[]),{collection:P,addToSet:function(e,r){try{return Promise.resolve(u(e,l,v)).then(function(e){var n=r?Promise.resolve(new Promise(function(n,t){return d.get(r).put(e,function(e){return e.ok?n():t(e.err)})})).then(function(){}):Promise.resolve(new Promise(function(r,n){return d.set(e,function(e){return e.ok?r():n(e.err)})})).then(function(){});if(n&&n.then)return n.then(function(){})})}catch(e){return Promise.reject(e)}},updateInSet:function(e,r){try{return Promise.resolve(u(r,l,v)).then(function(n){return Promise.resolve(new Promise(function(r,t){return d.get(e).put(n,function(e){return e.ok?r():t(e.err)})})).then(function(){y({type:"update",data:Object.assign({},{nodeID:e},r)})})})}catch(e){return Promise.reject(e)}},removeFromSet:function(e){try{return Promise.resolve(new Promise(function(r,n){return d.get(e).put(null,function(e){return e.ok?r():n(e.err)})})).then(function(){})}catch(e){return Promise.reject(e)}}}};export{u as encryptData,o as decryptData,i as debouncedUpdates,c as reducer,a as useIsMounted,s as useSafeReducer,f as useGun,l as useGunNamespace,v as useGunKeyAuth,p as useGunKeys,m as useGunState,d as useGunCollectionState};
//# sourceMappingURL=index.module.js.map
